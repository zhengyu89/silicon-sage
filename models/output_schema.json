{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Silicon Sage Build Report",
  "description": "Output payload generated by the MAS. Contains the finalized parts list, technical specs, and assembly instructions for the frontend to render.",
  "type": "object",
  "required": [
    "report_meta",
    "components",
    "performance_estimates"
  ],
  "properties": {
    "report_meta": {
      "type": "object",
      "properties": {
        "build_id": {
          "type": "string",
          "description": "Unique ID for this specific configuration (e.g., 'SS-2024-WORK-01')."
        },
        "generated_at": {
          "type": "string",
          "format": "date-time"
        },
        "total_estimated_cost": {
          "type": "number",
          "description": "Sum of all component prices found."
        },
        "currency": {
          "type": "string",
          "default": "MYR"
        }
      }
    },
    "components": {
      "type": "object",
      "description": "The selected hardware. GPU is optional for APU/Headless builds.",
      "required": ["cpu", "motherboard", "ram", "storage", "psu"],
      "properties": {
        "cpu": { "$ref": "#/definitions/component_cpu" },
        "motherboard": { "$ref": "#/definitions/component_motherboard" },
        "ram": { "$ref": "#/definitions/component_generic" },
        "storage": { "$ref": "#/definitions/component_generic" },
        "gpu": { "$ref": "#/definitions/component_gpu" },
        "psu": { "$ref": "#/definitions/component_psu" }
      }
    },
    "performance_estimates": {
      "type": "object",
      "description": "Predicted benchmarks and power requirements.",
      "properties": {
        "calculated_total_wattage": {
          "type": "integer",
          "description": "Sum of CPU TDP + GPU TGP + Mobo Draw + 100W buffer for drives/fans."
        },
        "gaming_1440p_fps": { "type": "string", "description": "e.g. '80-100 FPS (Ultra)'" },
        "workstation_score": { "type": "string", "description": "e.g. 'Cinebench R23: 18000 pts'" }
      }
    }
  },
  "definitions": {
    "component_base": {
      "type": "object",
      "required": ["model_name", "price", "vendor_url"],
      "properties": {
        "model_name": { "type": "string" },
        "price": { "type": "number" },
        "vendor_url": { "type": "string", "format": "uri", "description": "Direct link to Shopee/Store product page." }
      }
    },
    "component_cpu": {
      "allOf": [
        { "$ref": "#/definitions/component_base" },
        {
          "properties": {
            "specs": {
              "type": "object",
              "required": ["tdp_watts"],
              "properties": {
                "socket": { "type": "string", "description": "e.g. AM5, LGA1700" },
                "core_count": { "type": "string" },
                "base_boost_clock": { "type": "string" },
                "tdp_watts": { "type": "integer", "description": "Official Thermal Design Power in Watts." }
              }
            }
          }
        }
      ]
    },
    "component_gpu": {
      "allOf": [
        { "$ref": "#/definitions/component_base" },
        {
          "properties": {
            "specs": {
              "type": "object",
              "required": ["tgp_watts"],
              "properties": {
                "chipset": { "type": "string", "description": "e.g. RTX 4070 Super" },
                "vram": { "type": "string" },
                "length_mm": { "type": "integer", "description": "Critical for case compatibility" },
                "slot_width": { "type": "number", "description": "e.g. 2.5, 3.0 slots" },
                "tgp_watts": { "type": "integer", "description": "Total Graphics Power (TGP) in Watts." }
              }
            }
          }
        }
      ]
    },
    "component_motherboard": {
      "allOf": [
        { "$ref": "#/definitions/component_base" },
        {
          "properties": {
            "specs": {
              "type": "object",
              "required": ["max_power_draw_watts"],
              "properties": {
                "form_factor": { "type": "string", "enum": ["ATX", "mATX", "ITX"] },
                "socket": { "type": "string" },
                "rear_io_ports": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "List of actual ports (e.g. '1x USB-C 20Gbps', '2.5G LAN')"
                },
                "internal_headers": {
                  "type": "array",
                  "items": { "type": "string" },
                  "description": "Critical for front panel compatibility (e.g. '1x USB 3.2 Gen 2 Type-C Key-A')"
                },
                "max_power_draw_watts": {
                  "type": "integer",
                  "description": "Max power draw for Chipset/VRM/Onboard features (usually 50-100W)."
                }
              }
            }
          }
        }
      ]
    },
    "component_psu": {
      "allOf": [
        { "$ref": "#/definitions/component_base" },
        {
          "properties": {
            "specs": {
              "type": "object",
              "properties": {
                "wattage": { "type": "integer" },
                "rating": { "type": "string", "description": "e.g. 80+ Gold" },
                "modular": { "type": "string", "enum": ["Full", "Semi", "Non"] }
              }
            }
          }
        }
      ]
    },
    "component_generic": {
      "allOf": [
        { "$ref": "#/definitions/component_base" },
        {
          "properties": {
            "specs": {
              "type": "object",
              "additionalProperties": true
            }
          }
        }
      ]
    }
  }
}